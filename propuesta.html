<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>¬øTe quieres casar conmigo?</title>
<style>
  :root{
    --bg:#0f1020;
    --card:#0f1724;
    --accent:#ff3b6b;
    --accent-2:#ffb86b;
    --text:#f6f7fb;
    --muted:#b9c0d6;
  }
  html,body{height:100%; margin:0;}
  body{
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(255,59,107,0.06), transparent),
                radial-gradient(900px 500px at 90% 90%, rgba(255,184,107,0.03), transparent),
                var(--bg);
    color:var(--text);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    overflow-x: hidden;
  }

  .card{
    width:100%;
    max-width:920px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:18px;
    padding:28px;
    box-shadow: 0 10px 40px rgba(2,6,23,0.6);
    backdrop-filter: blur(6px);
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:20px;
    align-items:center;
  }
  @media(max-width:900px){ .card{grid-template-columns:1fr; padding:18px;} }

  .left{ padding:18px; }
  h1{ margin:0 0 8px 0; font-size:28px; letter-spacing:-0.2px; }
  p.lead{ margin:0 0 18px 0; color:var(--muted); }

  .proposal-text{
    background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding:16px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.03);
    margin-bottom:14px;
    font-size:16px;
    line-height:1.45;
    color:var(--text);
  }

  .buttons{ display:flex; gap:12px; flex-wrap:wrap; }
  button.big{
    font-size:18px; padding:12px 22px; border-radius:12px; border:0; cursor:pointer;
    user-select:none; transition:transform .12s ease;
    box-shadow: 0 8px 20px rgba(2,6,23,0.5);
  }
  button.big:active{ transform: translateY(2px); }
  .btn-yes{ background: linear-gradient(90deg,var(--accent), var(--accent-2)); color:white; }
  .btn-no{ background: transparent; color:var(--text); border:1px solid rgba(255,255,255,0.06); box-shadow:none; }

  .photo{ width:100%; max-height:420px; border-radius:12px; overflow:hidden; position:relative;
    display:flex; align-items:center; justify-content:center;
    background: radial-gradient(circle at 20% 10%, rgba(255,59,107,0.12), transparent 10%),
                linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.03); padding:18px; box-sizing:border-box;
  }

  .small{ color:var(--muted); font-size:13px; }

  /* overlay modal (simple) */
  .overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:2000; padding:24px; }
  .overlay.show{ display:flex; }
  .modal{
    width:100%; max-width:820px; background:linear-gradient(180deg, rgba(10,12,20,0.95), rgba(10,12,20,0.98));
    border-radius:16px; padding:28px; text-align:center; color:var(--text); box-shadow: 0 30px 80px rgba(2,6,23,0.7);
  }
  .modal h2{ margin:0 0 8px 0; font-size:26px; }
  .modal p{ color:var(--muted); margin:0 0 14px 0; }
  .modal .close{ margin-top:10px; display:inline-block; padding:10px 16px; border-radius:10px; background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--text); cursor:pointer; }

  /* confetti */
  canvas#confetti { position:fixed; inset:0; pointer-events:none; z-index:2500; }

  /* certificate modal */
  #certificateModal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:99999; align-items:center; justify-content:center; padding:20px; }
  .certificateCard{ width:100%; max-width:760px; background:linear-gradient(180deg,#fff,#fff8fb); color:#111; border-radius:18px; padding:28px; box-shadow: 0 30px 80px rgba(0,0,0,0.6); text-align:center; position:relative; overflow:hidden; }
  .certificateTitle{ font-family:"Georgia",serif; font-size:36px; color:#ff4fa3; margin:0; text-shadow:0 2px 6px rgba(255,79,163,0.12); }
  .certificateText{ color:#333; margin-top:8px; font-size:18px; line-height:1.4; }
  .certFrame{ border:3px solid rgba(255,79,163,0.12); padding:18px; border-radius:12px; margin-top:15px; background: linear-gradient(180deg, rgba(255,240,245,0.6), rgba(255,255,255,0.8)); }

  #signaturePad{ width:100%; height:220px; border-radius:10px; background:#fff; border:2px dashed #ffb3d1; touch-action:none; display:block; margin-top:12px; }

  .certButtons{ margin-top:14px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
  .btn-primary{ background: linear-gradient(90deg,var(--accent), var(--accent-2)); color:white; border:0; padding:10px 18px; border-radius:12px; font-size:16px; cursor:pointer; }
  .btn-ghost{ background:transparent; border:1px solid rgba(0,0,0,0.08); padding:10px 18px; border-radius:12px; cursor:pointer; }

  .floatHeart{ position:absolute; bottom:-20px; font-size:28px; color:#ff4fa3; animation:floatUp 6s linear forwards; pointer-events:none; opacity:0.95; }
  @keyframes floatUp{ 0%{ transform:translateY(0) rotate(0deg); opacity:1;} 100%{ transform:translateY(-120vh) rotate(30deg); opacity:0;} }

  #finalLoveScreen{ display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:1000000; align-items:center; justify-content:center; flex-direction:column; color:white; text-align:center; }
  #finalLoveScreen h1{ font-family:"Great Vibes", cursive; font-size:72px; color:#ff4fa3; margin:0; text-shadow:0 6px 30px rgba(255,79,163,0.2); }
  #finalLoveScreen p{ font-size:22px; margin-top:12px; color:#ffdce6; }

  #fireworksCanvas{ position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:999999; display:none; }

  @media (max-width:520px){ .certificateTitle{ font-size:28px; } #signaturePad{ height:160px; } }

  button:focus{ outline:3px solid rgba(255,59,107,0.15); outline-offset:3px; }
</style>
</head>
<body>

  <div class="card" role="main" aria-labelledby="title">
    <div class="left">
      <h1 id="title">¬øQuieres casarte conmigo?</h1>
      <p class="lead">Hace tiempo supe que eras la persona con la que quiero compartir mi vida. Esto es muy importante para m√≠ ‚Äî</p>

      <div class="proposal-text" id="customText" contenteditable="false" aria-label="Mensaje de propuesta">
        Mi amor, desde el primer d√≠a supe que estar contigo ser√≠a lo m√°s bonito que me podr√≠a pasar.
        ¬øQuieres pasar el resto de tu vida a mi lado, re√≠r conmigo, cuidarnos y construir nuestro hogar?
      </div>

      <div class="buttons" style="margin-top:12px;">
        <button class="big btn-yes" id="btnYes" aria-label="Bot√≥n s√≠">üíç S√ç, claro que s√≠</button>
        <button class="big btn-no" id="btnNo" aria-label="Bot√≥n no">üòî No ahora</button>
      </div>

      <div class="credit small" style="margin-top:14px"></div>
    </div>

    <div class="photo" aria-hidden="false">
      <div class="img">
        <div class="ring" aria-hidden="true">
          <!-- diamond ring SVG -->
          <svg viewBox="0 0 64 64" fill="none" aria-hidden="true">
            <path d="M41 17l4-6 6 4-5 6" stroke="url(#g1)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" opacity=".9"></path>
            <path d="M7 39c6-12 18-20 30-20s24 8 30 20c-6 12-18 20-30 20S13 51 7 39z" stroke="rgba(255,255,255,0.06)" stroke-width="1.2" fill="rgba(255,255,255,0.02)"></path>
            <defs>
              <linearGradient id="g1" x1="0" x2="1">
                <stop offset="0" stop-color="#fff"/>
                <stop offset="1" stop-color="#ffd3d3"/>
              </linearGradient>
            </defs>
          </svg>
        </div>

        <div style="text-align:center;">
          <strong style="font-size:18px">ROBINSON RUIZ</strong>
          <div class="small">Fecha: <span id="dateLabel"></span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- result overlay modal -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" id="modal">
      <h2 id="modalTitle"></h2>
      <p id="modalSub"></p>

      <!-- boton "Firmar compromiso" que aparecer√° cuando diga S√ç -->
      <div id="openCertContainer" style="margin-top:16px; display:none;">
        <button id="openCertificate" style="margin-top:8px; padding:12px 20px; font-size:18px; background:#ff7eb9; border:none; border-radius:12px; color:white; cursor:pointer;">
          Firmar compromiso üíç
        </button>
      </div>

      <div style="display:flex; gap:10px; justify-content:center; margin-top:12px;">
        <button class="close" id="modalClose">Cerrar</button>
        <button class="close" id="tryAgain" style="display:none">Volver a intentar</button>
      </div>
    </div>
  </div>

  <!-- confetti canvas -->
  <canvas id="confetti" aria-hidden="true"></canvas>

  <!-- CERTIFICATE MODAL (hidden by default) -->
  <div id="certificateModal" aria-hidden="true" role="dialog">
    <div class="certificateCard" id="certificateCard">
      <div class="certFrame" id="certInner">
        <h1 class="certificateTitle">Certificado de Compromiso üíç</h1>
        <p class="certificateText">Este documento certifica que <b>Valeri Bautista Pe√±a</b> y <b>Robinson Ruiz Olaya</b> han decidido unir sus vidas y caminar juntos hacia el matrimonio.</p>
        <p class="certificateText">Fecha: <span id="certDateLabel"></span></p>

        <div style="position:relative; margin-top:16px;">
          <div id="heartsContainer" style="position:absolute; inset:0; pointer-events:none;"></div>

          <h3 style="margin-top:6px; margin-bottom:6px;">Firma de Valeri:</h3>
          <canvas id="signaturePad" aria-label="√Årea de firma"></canvas>

          <div class="certButtons">
            <button class="btn-primary" id="saveSignatureBtn">Guardar firma</button>
            <button class="btn-primary" id="downloadCertBtn">Descargar certificado ‚ù§Ô∏è</button>
            <button class="btn-ghost" id="closeCertBtn">Cerrar</button>
            <button class="btn-ghost" id="clearSigBtn">Borrar firma</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- final love screen -->
  <div id="finalLoveScreen" role="dialog" aria-hidden="true">
    <h1>Valeri & Robinson üíñ</h1>
    <p>Destinados a estar juntos... siempre. üíç‚ú®</p>
  </div>

  <!-- fireworks canvas -->
  <canvas id="fireworksCanvas" aria-hidden="true"></canvas>

  <!-- m√∫sica (no autoplay until user interacts) -->
  <audio id="romanticMusic" loop preload="auto">
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_1d5df2da3b.mp3?filename=happy-acoustic-122210.mp3" type="audio/mpeg">
  </audio>

  <!-- html2canvas CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
/* ---------- variables y helpers ---------- */
let firmaGuardada = false;
const btnYes = document.getElementById('btnYes');
const btnNo  = document.getElementById('btnNo');
const overlay = document.getElementById('overlay');
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modalTitle');
const modalSub = document.getElementById('modalSub');
const modalClose = document.getElementById('modalClose');
const tryAgain = document.getElementById('tryAgain');
const dateLabel = document.getElementById('dateLabel');
const openCertContainer = document.getElementById('openCertContainer');
const openCertificateBtn = document.getElementById('openCertificate');

const certificateModal = document.getElementById('certificateModal');
const certDateLabel = document.getElementById('certDateLabel');
const closeCertBtn = document.getElementById('closeCertBtn');
const downloadCertBtn = document.getElementById('downloadCertBtn');
const saveSignatureBtn = document.getElementById('saveSignatureBtn');
const clearSigBtn = document.getElementById('clearSigBtn');
const heartsContainer = document.getElementById('heartsContainer');
const romanticMusic = document.getElementById('romanticMusic');
const finalLoveScreen = document.getElementById('finalLoveScreen');

const confettiCanvas = document.getElementById('confetti');
const confettiCtx = confettiCanvas.getContext('2d');
let confettiPieces = [];
let confettiT = null;

/* fecha */
(function(){
  const d = new Date();
  const opts = { year:'numeric', month:'long', day:'numeric' };
  dateLabel.textContent = d.toLocaleDateString(undefined, opts);
})();

/* overlay helpers */
function showOverlay(title, sub, options = {}) {
  modalTitle.textContent = title;
  modalSub.textContent = sub;
  overlay.classList.add('show');
  overlay.setAttribute('aria-hidden','false');
  tryAgain.style.display = options.tryAgain ? 'inline-block' : 'none';
  openCertContainer.style.display = options.showSignButton ? 'block' : 'none';
}
function hideOverlay(){
  overlay.classList.remove('show');
  overlay.setAttribute('aria-hidden','true');
}
modalClose.addEventListener('click', hideOverlay);
tryAgain.addEventListener('click', hideOverlay);

/* confetti */
function resizeConfettiCanvas(){
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeConfettiCanvas);
resizeConfettiCanvas();

function random(min,max){ return Math.random()*(max-min)+min; }

function startConfetti(){
  confettiPieces = [];
  const colors = ['#ff3b6b','#ffb86b','#ffd86b','#7bf3d6','#8ab6ff','#c98bff'];
  for(let i=0;i<150;i++){
    confettiPieces.push({
      x: random(0, confettiCanvas.width),
      y: random(-confettiCanvas.height, 0),
      w: random(6, 12),
      h: random(8, 18),
      vx: random(-0.8, 0.8),
      vy: random(1.5, 4),
      color: colors[Math.floor(random(0, colors.length))],
      rot: random(0, 360),
      rotSpeed: random(-6, 6),
      opacity: random(0.8, 1)
    });
  }
  if (confettiT) cancelAnimationFrame(confettiT);
  confettiLoop();
  setTimeout(()=>{ confettiPieces = []; }, 8000);
}

function confettiLoop(){
  confettiCtx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
  for(let p of confettiPieces){
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.02;
    p.rot += p.rotSpeed;
    confettiCtx.save();
    confettiCtx.globalAlpha = p.opacity;
    confettiCtx.translate(p.x, p.y);
    confettiCtx.rotate(p.rot * Math.PI / 180);
    confettiCtx.fillStyle = p.color;
    confettiCtx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
    confettiCtx.restore();
  }
  confettiPieces = confettiPieces.filter(p => p.y < confettiCanvas.height + 60);
  if(confettiPieces.length > 0) confettiT = requestAnimationFrame(confettiLoop);
  else confettiCtx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
}

/* botones S√≠/No */
btnYes.addEventListener('click', () => {
  startConfetti();
  showOverlay('¬°Dijo S√ç! üéâ', 'No puedo esperar para empezar esta nueva etapa contigo. Te amo.', {tryAgain:false, showSignButton:true});
  modalClose.focus();
});
btnNo.addEventListener('click', () => {
  showOverlay('Lo entiendo üíõ', 'Gracias por ser honesta. Te respeto y esto no cambia lo mucho que te quiero. Si quieres, podemos intentarlo de nuevo.', {tryAgain:true, showSignButton:false});
  tryAgain.focus();
});
btnYes.addEventListener('keyup', (e)=>{ if(e.key === 'Enter') btnYes.click(); });
btnNo.addEventListener('keyup', (e)=>{ if(e.key === 'Enter') btnNo.click(); });
document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') hideOverlay(); });

/* abrir certificado */
openCertificateBtn.addEventListener('click', () => {
  hideOverlay();
  certificateModal.style.display = 'flex';
  certificateModal.setAttribute('aria-hidden','false');

  // poner fecha del certificado
  const hoy = new Date();
  certDateLabel.textContent = hoy.getDate() + "/" + (hoy.getMonth()+1) + "/" + hoy.getFullYear();

  startFloatingHearts();

  // permitir m√∫sica con primer gesto del usuario
  document.body.addEventListener('click', enableMusicOnce, { once: true });
});

/* cerrar certificado */
closeCertBtn.addEventListener('click', () => {
  certificateModal.style.display = 'none';
  certificateModal.setAttribute('aria-hidden','true');
  stopHearts();
  romanticMusic.pause();
});

/* enable music */
function enableMusicOnce(){
  try {
    romanticMusic.volume = 0.6;
    romanticMusic.play().catch(()=>{});
  } catch(e){}
}

/* ---------------- Signature pad (in certificate) ---------------- */
const sigCanvas = document.getElementById('signaturePad');
const sigCtx = sigCanvas.getContext('2d');

function resizeSigCanvas(){
  // preserve existing strokes by drawing them onto a temporary canvas before resizing is possible but here we start blank
  const ratio = window.devicePixelRatio || 1;
  const rect = sigCanvas.getBoundingClientRect();
  const w = rect.width || 600;
  const h = rect.height || 220;
  sigCanvas.width = Math.floor(w * ratio);
  sigCanvas.height = Math.floor(h * ratio);
  sigCanvas.style.width = w + "px";
  sigCanvas.style.height = h + "px";
  sigCtx.setTransform(1,0,0,1,0,0); // reset
  sigCtx.scale(ratio, ratio);
  sigCtx.lineWidth = 2.7;
  sigCtx.lineCap = 'round';
  sigCtx.strokeStyle = "#000";
  sigCtx.clearRect(0,0,sigCanvas.width,sigCanvas.height);
}
(function ensureSigSize(){
  // give a default size if CSS hasn't set one
  if (!sigCanvas.style.height || sigCanvas.style.height === "") sigCanvas.style.height = "220px";
  if (!sigCanvas.style.width || sigCanvas.style.width === "") sigCanvas.style.width = "100%";
  // small timeout to ensure layout
  setTimeout(resizeSigCanvas, 80);
})();
window.addEventListener('resize', resizeSigCanvas);

let drawing = false;
function getPointerPos(e){
  const rect = sigCanvas.getBoundingClientRect();
  if (e.touches && e.touches.length > 0){
    return { x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top };
  } else {
    return { x: e.clientX - rect.left, y: e.clientY - rect.top };
  }
}
sigCanvas.addEventListener('mousedown', (e) => {
  drawing = true;
  const p = getPointerPos(e);
  sigCtx.beginPath();
  sigCtx.moveTo(p.x, p.y);
});
sigCanvas.addEventListener('mousemove', (e) => {
  if (!drawing) return;
  const p = getPointerPos(e);
  sigCtx.lineTo(p.x, p.y);
  sigCtx.stroke();
});
sigCanvas.addEventListener('mouseup', () => { drawing = false; animateOnSign(); });
sigCanvas.addEventListener('mouseleave', () => { drawing = false; });

sigCanvas.addEventListener('touchstart', (e) => {
  e.preventDefault();
  drawing = true;
  const p = getPointerPos(e);
  sigCtx.beginPath();
  sigCtx.moveTo(p.x, p.y);
}, {passive:false});
sigCanvas.addEventListener('touchmove', (e) => {
  e.preventDefault();
  if (!drawing) return;
  const p = getPointerPos(e);
  sigCtx.lineTo(p.x, p.y);
  sigCtx.stroke();
}, {passive:false});
sigCanvas.addEventListener('touchend', (e) => {
  drawing = false;
  animateOnSign();
}, {passive:false});

/* clear signature */
clearSigBtn.addEventListener('click', () => {
  // clear logical canvas
  sigCtx.clearRect(0,0,sigCanvas.width,sigCanvas.height);
  // reset transform and resize to ensure crispness
  resizeSigCanvas();
});

/* save signature (just confirmation) */
saveSignatureBtn.addEventListener('click', () => {
  firmaGuardada = true; // üî• AHORA S√ç SE MARCA LA FIRMA COMO GUARDADA

  alert("Firma guardada con √©xito üíó");
  document.getElementById('certInner').style.animation = 'modalPulse 0.7s ease';
  setTimeout(()=> document.getElementById('certInner').style.animation = '', 800);
});

/* download certificate using html2canvas */
downloadCertBtn.addEventListener('click', async () => {
  if (!firmaGuardada) {
  alert("Primero debes guardar la firma antes de descargar el certificado ‚ù§Ô∏è");
  return; 
}
  try {
    // show any hearts for capture
    const elem = document.getElementById('certInner');
    const canvas = await html2canvas(elem, { scale: 1 });
    const link = document.createElement('a');
    link.download = 'certificado_valeri_y_robinson.png';
    link.href = canvas.toDataURL('image/png');
    link.click();

    // fireworks and final screen
    startFireworks();
    setTimeout(() => {
      finalLoveScreen.style.display = 'flex';
      finalLoveScreen.setAttribute('aria-hidden','false');
    }, 1400);
  } catch (err) {
    console.error(err);
    alert("Error al generar la imagen. Por favor intenta de nuevo.");
  }
});

/* small animation when the user draws a signature */
function animateOnSign(){
  const h = document.createElement('div');
  h.className = 'floatHeart';
  h.style.left = Math.random()*80 + '%';
  h.style.bottom = '10px';
  h.textContent = '‚ù§';
  document.getElementById('certInner').appendChild(h);
  setTimeout(()=> h.remove(), 6000);
}

/* floating hearts */
let heartsInterval = null;
function startFloatingHearts(){
  stopHearts();
  heartsInterval = setInterval(() => {
    const h = document.createElement('div');
    h.className = 'floatHeart';
    h.style.left = Math.random()*90 + '%';
    h.style.fontSize = (20 + Math.random()*30) + 'px';
    h.textContent = '‚ù§';
    heartsContainer.appendChild(h);
    setTimeout(()=> { try { h.remove(); } catch(e){} }, 6000);
  }, 450);
}
function stopHearts(){
  if (heartsInterval) clearInterval(heartsInterval);
  heartsContainer.innerHTML = '';
}

/* fireworks (simple but nice) */
function startFireworks(){
  const canvas = document.getElementById('fireworksCanvas');
  const ctxF = canvas.getContext('2d');
  canvas.style.display = 'block';
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  let particles = [];
  function boom(x,y){
    for (let i=0;i<60;i++){
      particles.push({
        x, y,
        velX: (Math.random()-0.5) * (Math.random()*6+2),
        velY: (Math.random()-0.7) * (Math.random()*6+2),
        size: Math.random()*3 + 1,
        life: 60 + Math.random()*30,
        color: `hsl(${Math.random()*360},80%,60%)`
      });
    }
  }
  function update(){
    ctxF.fillStyle = "rgba(0,0,0,0.18)";
    ctxF.fillRect(0,0,canvas.width, canvas.height);
    for (let i = particles.length-1; i>=0; i--){
      const p = particles[i];
      p.x += p.velX;
      p.y += p.velY;
      p.velY += 0.06;
      p.life--;
      ctxF.fillStyle = p.color;
      ctxF.globalAlpha = Math.max(0, p.life/90);
      ctxF.fillRect(p.x, p.y, p.size, p.size);
      if (p.life <= 0) particles.splice(i,1);
    }
    ctxF.globalAlpha = 1;
    if (particles.length > 0) requestAnimationFrame(update);
    else { setTimeout(()=> canvas.style.display='none', 400); }
  }

  // launch a few booms
  for (let i=0;i<5;i++){
    setTimeout(()=> boom(Math.random()*canvas.width, Math.random()*canvas.height*0.5 + 50), i*300);
  }
  update();
}

/* responsive for fireworks canvas on resize */
window.addEventListener('resize', () => {
  const c = document.getElementById('fireworksCanvas');
  c.width = window.innerWidth;
  c.height = window.innerHeight;
  resizeConfettiCanvas();
});

/* close final screen */
finalLoveScreen.addEventListener('click', () => {
  finalLoveScreen.style.display = 'none';
  finalLoveScreen.setAttribute('aria-hidden','true');
});

/* prevent selection while drawing */
document.body.addEventListener('selectstart', (e) => {
  if (e.target === sigCanvas) e.preventDefault();
});

/* ensure signature canvas resize after load */
window.addEventListener('load', () => { setTimeout(resizeSigCanvas, 200); });

/* accessible focus for modal close */
modalClose.addEventListener('keydown', (e)=>{ if(e.key==='Enter') hideOverlay(); });

/* end script */
</script>

</body>
</html>
